# 使用指南

## 🚀 快速上手

### 第一次使用

1. **下載第三方庫**
   ```bash
   python3 download_libs.py
   ```
   這將自動下載所有必需的 JavaScript 庫到 `public/libs` 目錄。

2. **啟動應用**
   - 使用本地服務器（推薦）：`python3 -m http.server 8000`
   - 或直接用瀏覽器打開 `index.html`

3. **首次初始化**
   - 系統自動創建 IndexedDB 數據庫
   - 載入預設稅務規則（2025年度）

---

## 📋 功能使用說明

### 一、扣繳稅額計算

#### 計算薪資扣繳

1. 進入「計算工作台」→「扣繳計算」
2. 選擇所得類別：**薪資所得**
3. 選擇身份：本國居民 / 非居民
4. 輸入給付金額：例如 `100000`
5. 點擊「計算」按鈕

**結果示例：**
```
給付金額：100,000 元
扣繳稅額：5,000 元（5%）
實領金額：95,000 元
適用規則：月薪 ≥ 88,501 元，扣繳 5%
法律依據：所得稅法第88條
```

#### 計算租金扣繳

1. 選擇所得類別：**租金所得**
2. 選擇身份：本國居民（10%）或 非居民（20%）
3. 輸入租金金額：例如 `50000`
4. 系統自動計算扣繳稅額

**本國居民：** 50,000 × 10% = 5,000 元  
**非居民：** 50,000 × 20% = 10,000 元

---

### 二、二代健保補充保費計算

#### 高額獎金計算

**情境：** 員工投保薪資 40,000 元，發放年終獎金 200,000 元

1. 進入「計算工作台」→「二代健保」
2. 選擇類別：**高額獎金**
3. 輸入投保薪資：`40000`
4. 輸入獎金金額：`200000`

**計算步驟：**
```
投保薪資 4 倍 = 40,000 × 4 = 160,000
超過部分 = 200,000 - 160,000 = 40,000
補充保費 = 40,000 × 2.11% = 844 元
```

#### 兼職收入計算

**情境：** 兼職薪資 35,000 元

1. 選擇類別：**兼職收入**
2. 輸入金額：`35000`

**結果：**
```
基本工資門檻：28,590 元
兼職收入：35,000 元（≥ 基本工資）
補充保費 = 35,000 × 2.11% = 739 元
```

#### 執行業務/股利/利息/租金

**門檻：** 單次給付 ≥ 20,000 元

- **低於門檻：** 免計收
- **達到門檻：** 全額 × 2.11%

**範例：**
- 稿費 15,000 元 → 免計收
- 稿費 25,000 元 → 25,000 × 2.11% = 528 元

---

### 三、綜合所得稅計算

#### 基本流程

1. 進入「計算工作台」→「綜所稅」
2. 輸入年度總所得
3. 設定免稅額（本人 + 配偶 + 扶養親屬）
4. 選擇扣除額方式（標準 vs 列舉）
5. 勾選適用的特別扣除額
6. 系統自動計算應納稅額

#### 範例：單身上班族

**基本資料：**
- 薪資所得：800,000 元
- 利息所得：10,000 元
- 無其他所得

**計算步驟：**
```
1. 綜合所得總額 = 800,000 + 10,000 = 810,000

2. 免稅額（本人） = 97,000

3. 標準扣除額（單身） = 131,000

4. 特別扣除額：
   - 薪資特別扣除 = 218,000
   - 儲蓄投資特別扣除 = 10,000
   合計 = 228,000

5. 綜合所得淨額 = 810,000 - 97,000 - 131,000 - 228,000 = 354,000

6. 適用稅率級距：第1級 (0 ~ 610,000)
   應納稅額 = 354,000 × 5% = 17,700 元
```

#### 股利二擇一優化

**情境：** 股利所得 500,000 元，其他所得 1,000,000 元

系統自動比較兩種方案：

**方案 A：合併計稅 + 抵減**
- 股利併入綜合所得
- 可抵減稅額 = 500,000 × 8.5% = 42,500（上限 80,000）
- 實際抵減 = 42,500

**方案 B：分開計稅 28%**
- 股利單獨課稅 = 500,000 × 28% = 140,000
- 其他所得另計

系統自動選擇稅負較低的方案。

---

### 四、營利事業所得稅計算

#### 基本計算

1. 進入「計算工作台」→「營所稅」
2. 輸入會計淨利
3. 填寫稅務調整項目（帳外收入、不可扣除費用等）
4. 選擇前期虧損扣抵
5. 系統計算應納稅額

#### 範例：一般公司

**基本資料：**
- 會計淨利：5,000,000 元
- 帳外收入：200,000 元
- 交際費超限：50,000 元
- 前期虧損：1,000,000 元

**計算步驟：**
```
1. 課稅所得 = 會計淨利 + 調整項 - 虧損扣抵
   = 5,000,000 + 200,000 + 50,000 - 1,000,000
   = 4,250,000

2. 標準稅額 = 4,250,000 × 20% = 850,000

3. 基本稅額 = (課稅所得 + 免稅所得) × 12%（一般企業）

4. 應納稅額 = max(標準稅額, 基本稅額)
```

#### 未分配盈餘稅

**稅後淨利分配：**
- 已分配股利：免課未分配盈餘稅
- 未分配保留：次次年課徵 5%

**範例：**
```
稅後淨利：3,000,000
已分配股利：2,000,000
法定盈餘公積：300,000

未分配盈餘 = 3,000,000 - 2,000,000 - 300,000 = 700,000
未分配盈餘稅 = 700,000 × 5% = 35,000（次次年申報）
```

---

## 🔧 進階功能

### 客戶案件管理

1. **新增客戶**
   - 點擊「客戶管理」→「新增客戶」
   - 填寫統一編號、公司名稱、聯絡資訊
   - 系統自動驗證統編格式

2. **建立案件**
   - 選擇客戶 → 點擊「新增案件」
   - 選擇年度與案件類型（扣繳/健保/綜所稅/營所稅）
   - 填寫案件資料並保存

3. **上傳文件**
   - 進入案件詳情
   - 拖放文件至上傳區域
   - 系統自動關聯文件與案件

### 規則管理

1. **上傳 PDF 規則**
   - 進入「規則後台」→「PDF 上傳」
   - 選擇法規 PDF 文件
   - 系統自動提取文本

2. **規則解析**
   - 系統識別條文編號、稅率、門檻
   - 生成規則卡草稿
   - 人工審核與編輯

3. **版本控制**
   - 每次規則更新自動遞增版本號
   - 舊版規則保留，可查詢歷史記錄
   - 新版規則設定生效日期

4. **衝突檢測**
   - 系統自動檢查規則條件重疊
   - 提示潛在衝突供審核
   - 確認無誤後發布新版

---

## 💾 數據備份與恢復

### 導出備份

1. 進入「系統設定」→「數據管理」
2. 點擊「導出備份」
3. 選擇備份範圍：
   - 全部數據（客戶 + 案件 + 規則 + 計算結果）
   - 僅客戶與案件
   - 僅規則庫
4. 系統生成 JSON 文件下載

### 導入備份

1. 點擊「導入備份」
2. 選擇備份文件（JSON 格式）
3. 選擇導入策略：
   - 覆蓋現有數據
   - 合併數據（保留衝突項）
   - 僅新增（跳過已存在項）
4. 確認導入

---

## 🛡️ 安全注意事項

### 數據安全

- ✅ 所有數據存於本地，不上傳雲端
- ✅ 瀏覽器關閉後數據仍保留
- ⚠️ 清除瀏覽器數據會刪除所有資料
- 💡 建議定期備份重要案件

### 使用建議

- 🔒 使用 HTTPS 本地服務器
- 🔒 避免在公共電腦使用
- 🔒 退出時鎖定電腦螢幕
- 🔒 重要案件使用加密備份

---

## ❓ 常見問題

### Q1: 計算結果與國稅局不同？

**A:** 可能原因：
1. 規則版本不同（檢查生效日期）
2. 輸入參數有誤
3. 特殊減免未納入

建議：核對所有輸入參數，必要時諮詢稅務專業人士。

### Q2: 數據突然消失？

**A:** 檢查：
1. 是否清除了瀏覽器數據
2. 是否使用無痕模式
3. 是否更換了瀏覽器

解決：從備份文件恢復數據。

### Q3: 系統無法啟動？

**A:** 檢查：
1. 第三方庫是否完整下載（`public/libs/` 目錄）
2. 瀏覽器控制台是否有錯誤訊息
3. 瀏覽器版本是否過舊（需 Chrome 90+）

### Q4: 如何更新稅率？

**A:** 
1. 進入「規則後台」
2. 上傳最新法規 PDF
3. 審核規則卡並發布
4. 舊案件可重新計算

---

## 📞 技術支援

- **GitHub Issues**: https://github.com/maotai11/Accountoffline-/issues
- **文檔更新**: 定期檢查 README.md

---

**祝您使用愉快！💼**
